/**
 * React Router Manage v1.0.9
 *
 * Copyright (c) onshinpei Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
import{Navigate as e,Router as t}from"react-router-dom";export{AbortedDeferredError,Await,Form,Link,MemoryRouter,NavLink,Navigate,NavigationType,Outlet,Route,Router,RouterProvider,Routes,ScrollRestoration,UNSAFE_DataRouterContext,UNSAFE_DataRouterStateContext,UNSAFE_DataStaticRouterContext,UNSAFE_LocationContext,UNSAFE_NavigationContext,UNSAFE_RouteContext,UNSAFE_enhanceManualRouteObjects,createBrowserRouter,createHashRouter,createMemoryRouter,createPath,createRoutesFromChildren,createRoutesFromElements,createSearchParams,defer,generatePath,isRouteErrorResponse,json,matchPath,matchRoutes,parsePath,redirect,renderMatches,resolvePath,useActionData,useAsyncError,useAsyncValue,useFetcher,useFetchers,useFormAction,useHref,useInRouterContext,useLoaderData,useLocation,useMatch,useMatches,useNavigate,useNavigation,useNavigationType,useOutlet,useOutletContext,useParams,useResolvedPath,useRevalidator,useRouteError,useRouteLoaderData,useRoutes,useSearchParams}from"react-router-dom";import*as n from"react";import{useState as r,useLayoutEffect as o,useMemo as u,useRef as a,useCallback as s,useReducer as i,useImperativeHandle as c,useEffect as l,Suspense as p}from"react";import{Navigate as m,useLocation as h,useParams as f,useNavigate as R,generatePath as d,useRoutes as E}from"react-router";import{parse as _,stringify as y}from"query-string";import{unstable_batchedUpdates as A}from"react-dom";import{createBrowserHistory as g,createHashHistory as b}from"@remix-run/router";const v={401:{title:"无权限查看该页面",img:"//ysf.qiyukf.net/yx/9c9ce7793b3c0657da5d80e740a89681"},404:{title:"页面不存在",img:"https://ysf.nosdn.127.net/ysh/6be90dea7806767fe65e7b48982b7a61"}},T=({code:e="401"})=>{const t=v[e];return n.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",background:"white",height:"100%",flexDirection:"column",borderRadius:8}},n.createElement("img",{alt:t.title,width:200,src:t?.img}),n.createElement("div",{style:{color:"#666666",lineHeight:"22px",textAlign:"center",marginTop:16}},t.title))};T.displayName="NoAuth";const C=({name:t,component:r})=>{const{routesMap:o,currentRoute:u}=he(),a=o[t];return t===u.name?r?n.createElement(r,null):n.createElement(n.Fragment,null):n.createElement(e,{to:a.path||""})},M=({tip:e="加载中"})=>n.createElement("div",null,e),U={LoadingComponent:()=>n.createElement(n.Fragment,null,n.createElement(M,{tip:"应用正在加载中…"}))};function P(t,r){let o;return t?(!function(e){if(e instanceof Function)return!0;return!1}(t)?G(t.path)?o=function(){return n.createElement(e,{to:t.path})}:G(t.name)&&(o=function(){return n.createElement(C,{name:t.name,component:r})}):o=t,o):o}const L=({beforeEnter:e,Component:t,beforeEachMount:u})=>{const[a,s]=r({Component:void 0}),{currentRoute:i}=he();o((()=>{let n=!0;return u?u(i,(r=>{if(!n)return;const o=P(r,t);e?e(i,(e=>{if(!n)return;const r=P(e,o||t);s({Component:r||o||t})})):s({Component:o||t})})):e&&e(i,(e=>{if(!n)return;const r=P(e,t);s({Component:r||t})})),()=>{n=!1}}),[t,i,e,u]);const c=U.LoadingComponent;return a.Component?n.createElement(a.Component,null):n.createElement(c,null)},N=()=>n.createElement(T,{code:"404"});let D=1;const w=()=>{const e=`__routerName${D}`;return D+=1,e};function S(e,t="/",n){return e.startsWith(t)?e:e===t?t:e.startsWith("/")?t.endsWith("/")?`${t}${e.slice(1)}`:`${t}${e}`:n?S(e,n):t.endsWith("/")?`${t}${e}`:`${t}/${e}`}function O(e){const{routes:t,parent:n,basename:r="/",_level:o=1}=e;if(!t)return[];return function e(t,n,o=1){return t.map((t=>{const{path:u,items:a,children:s,...i}=t,c={...i,path:I(S(u,r,n?.path)),parent:n,_level:o,_relativePath:u};return a&&(c.items=e(a,c,o+1)),s&&(c.children=e(s,c,o+1)),c}))}(t,n,o)}function x(e){const{inputRoutes:t,permissionList:n,hasAuth:r,beforeEachMount:o,basename:u,location:a}=e,s=q({routes:t,permissionList:n,hasAuth:r,beforeEachMount:o}),i=$(s,void 0,!0);!function(e,t,n){const r=S("*",t);if(e.some((({path:e})=>e===r)))return;const o={name:"notFound",title:"notFound",meta:{},path:r,component:N,_component:N,_relativePath:r,_level:0};n.push(o),e.push(o)}(i,u,s);const c=k(i),l=F(a.pathname,c);return{authInputRoutes:s,flattenRoutes:i,routesMap:c,currentRoute:l,currentPathRoutes:H(l),beforeEachMount:o}}const $=(e,t,n)=>e.reduce(((e,r)=>{if(t&&(r.parent=t),Array.isArray(r.items)||Array.isArray(r.children)){let t=e.concat(r);return Array.isArray(r.items)&&(t=t.concat($(r.items,r,n))),Array.isArray(r.children)&&n&&(t=t.concat($(r.children,r,n))),t}return e.concat(r)}),[]),k=e=>{const t=e.reduce(((e,t)=>{const{name:n,path:r}=t;if(e[n]||e[r])throw new Error(`route config name or path isn't unique, route name: "${n}", route path: "${r}"`);if(r.includes(":")){const n=r.replace(/:(\w+)/g,(()=>"([^\\/]+)"));e.__paramsRoutesMap[n]=t}return e[n]=e[r]=t,e}),{__paramsRoutesMap:{},__flattenRoutes:[]});return t.__flattenRoutes=e,t};function I(e){return e&&e.endsWith("/")?e.slice(0,-1):e}function F(e=window.location.pathname,t){e=I(e);let r=t[e];if(!r){const n=Object.keys(t.__paramsRoutesMap);let o=0;for(;!r&&o<n.length;){const u=new RegExp(n[o]);if(e.match(u)){r=t.__paramsRoutesMap[n[o]];break}o+=1}}if(!r){const n=t.__flattenRoutes.map((e=>e.path)).filter((e=>e.endsWith("*")));let o="";n.forEach((n=>{if(n=B(n),!e.startsWith(n))return;n in t&&n.length>o.length&&(o=n);let r=`${n}*`;r in t&&r.length>o.length&&(o=r),r=`${n}/*`,r in t&&r.length>o.length&&(o=r),r=`${e}*`,r in t&&r.length>o.length&&(o=r),r=`${e}/*`,r in t&&r.length>o.length&&(o=r)})),o&&(r=t[o])}return r||(r={name:"404",path:e,title:"404",_isHasAuth:!1,_relativePath:"",_level:0,meta:{},component:()=>n.createElement(T,null)}),r}function H(e){const t=[];let n=e;for(;n;)t.unshift(n),n=n.parent;return t}function W(e,t){return t.includes(e)}function j({code:e,permissionList:t,hasAuth:n,route:r}){return!n||(!e||(Array.isArray(e)?0===e.length||e.some((e=>W(e,t))):e instanceof Function?!!function(e,t){return e(t)}(e,r):W(e,t)))}function q(e){const{routes:t,permissionList:r=[],hasAuth:o,beforeEachMount:u,parent:a}=e;return t.map((e=>{const{component:t,path:s,code:i="",children:c,items:l,beforeEnter:p,redirect:h,meta:f,type:R,...d}=e;let E=[],_=[],y=t;const A={};(p||u)&&(y=L,A.beforeEnter=p,A.beforeEachMount=u,A.Component=t,A.key=e.name,A._route=e);const g=j({code:i,permissionList:r,hasAuth:o,route:e}),b={...e,parent:a,props:A,meta:f||{},items:[],children:[],_route:e,_isHasAuth:g};if(!g){let t=[];if(!s.endsWith("*")){const n=s.endsWith("/")?`${s}*`:`${s}/*`;t=[{meta:{},name:w(),path:n,title:"",hidden:!0,component:T,_level:d._level+1,_route:e,_component:T,_relativePath:"*"}]}const n={...b,items:t,children:[],_component:T};return t.forEach((e=>{e.parent=n})),n}c&&(E=q({routes:c,permissionList:r,hasAuth:o,beforeEachMount:u,parent:b})),l&&(_=q({routes:l,permissionList:r,hasAuth:o,beforeEachMount:u,parent:b}));const v=[..._,...E];if(h)return{...b,children:E,items:_,_component:()=>n.createElement(m,{to:h,replace:!0}),_itemsAndChildren:v};if("null"===R)return{...b,children:E,items:_,_component:void 0,_itemsAndChildren:v};if(t)return{...b,children:E,items:_,_component:y,_itemsAndChildren:v};{const t=z(e,r,o);if(t){let r=!1;return e.parent?.component||(r=!0),{...b,children:E,items:_,_component:()=>n.createElement(m,{to:t,replace:r}),_itemsAndChildren:v}}return{...b,items:[],children:[],_component:T}}}))}function B(e){return"/"===e?e:e.replace(/\/*\**$/gm,"")}function V(e){if("string"==typeof e)return B(e);const{pathname:t}=e;return t?{...e,pathname:B(t)}:e}const z=(e,t,n)=>{const{items:r}=e;if(!r)return"";if(!n)return r[0].path;let o="";for(let u=0;u<r?.length;u++){const e=r[u],{code:a,path:s}=e;if(!a){o=s;break}if(j({code:a,permissionList:t,hasAuth:n,route:e})){o=s;break}}return o};function G(e){return"string"==typeof e}let J=0;function K(e){const{LoadingComponent:t,...n}=e;var r;J+=1,t&&(r={LoadingComponent:t},Object.entries(r).forEach((([e,t])=>{U[e]=t})));return{...n,_isDefined:!0,_defineId:J}}function Q(e){return e?e.reduce(((e,t)=>e.concat(Array.isArray(t)?Q(t):t)),[]):[]}let X=new Map;const Y=n.createContext(null);function Z(){return n.useContext(Y).history}function ee(){return n.useContext(Y).routeHooksRef}function te({basename:e,children:r,syncUpdateCurrentRoute:o}){const a=n.useRef(null),s=n.useRef(null);null==a.current&&(a.current=g({window}),s.current=[]);const i=u((()=>({history:a.current,routeHooks:s.current,routeHooksRef:s,historyMethods:{push:a.current.push,replace:a.current.replace,go:a.current.go}})),[]),c=a.current,[l,p]=n.useState({action:c.action,location:c.location});return n.useLayoutEffect((()=>{let e=!0;return c.listen((t=>{const{location:n}=t;e&&A((()=>{p(t),o(n)}))})),()=>{e=!1}}),[c,o]),n.createElement(Y.Provider,{value:i},n.createElement(t,{basename:e,location:l.location,navigationType:l.action,navigator:c},r))}function ne({basename:e,children:r,syncUpdateCurrentRoute:o}){const a=n.useRef(null),s=n.useRef(null);null==a.current&&(a.current=b({window}),s.current=[]);const i=u((()=>({history:a.current,routeHooks:s.current,routeHooksRef:s,historyMethods:{push:a.current.push,replace:a.current.replace,go:a.current.go}})),[]),c=a.current,[l,p]=n.useState({action:c.action,location:c.location});return n.useLayoutEffect((()=>{let e=!0;return c.listen((t=>{const{location:n}=t;e&&A((()=>{p(t),o(n)}))})),()=>{e=!1}}),[c,o]),n.createElement(Y.Provider,{value:i},n.createElement(t,{basename:e,location:l.location,navigationType:l.action,navigator:c},r))}let re,oe;function ue(e){const t={};return{inputRoutes:function e(n,r){return n?n.map((n=>{const o={...n,items:[],children:[],parent:r};return o.items=e(n.items,o),o.children=e(n.children,o),t[n.name]=o,o}),[]):[]}(e),routesMap:t}}Y.displayName="MRouterHistoryContext",function(e){e[e.menu=0]="menu",e[e.step=1]="step"}(re||(re={})),function(e){e.UPDATE_INPUT_ROUTES="UPDATE_INPUT_ROUTES",e.UPDATE_CURRENT_ROUTE="UPDATE_CURRENT_ROUTE",e.UPDATE_STATE="UPDATE_STATE",e.ADD_ROUTES="ADD_ROUTES",e.REMOVE_ROUTES="REMOVE_ROUTES",e.UPDATE_ROUTES="UPDATE_ROUTES"}(oe||(oe={}));const ae=n.createContext({state:{inputRoutes:[],authInputRoutes:[],permissionList:[],routesMap:{},flattenRoutes:[]},methods:{}});function se(e,t){const{type:n,payload:r}=t;switch(n){case oe.ADD_ROUTES:return function(e,t){let n=!1;const r=t,{routesMap:o,inputRoutes:u}=ue(e.inputRoutes);if(r.forEach((e=>{const{path:t,name:r,parentName:a}=e;if(o[t]||o[r])throw new Error(`新增路由 ${r} ${t} 已经存在，请修改`);if(a){const t=o[a];if(t){const r=O({routes:[e],parent:t,_level:t._level+1});t.items=t.items||[],t.items.push(r[0]),n=!0}}else{const t=O({routes:[e],_level:0});u.push(t[0]),n=!0}})),n){const t=e._getNewStateByNewInputRoutes(u);return{...e,...t,inputRoutes:[...u]}}return e}(e,r);case oe.REMOVE_ROUTES:return function(e,t){let n=!1;const r=t,{routesMap:o,inputRoutes:u}=ue(e.inputRoutes);if(r.forEach((e=>{const t=o[e];if(t){const e=t.parent;if(!e){const e=u.indexOf(t);e>-1&&(u.splice(e,1),n=!0)}if(e&&e.items){const r=e.items.indexOf(t);r>-1&&(e.items.splice(r,1),n=!0)}}})),n){const t=e._getNewStateByNewInputRoutes(u);return{...e,...t,inputRoutes:[...u]}}return e}(e,r);case oe.UPDATE_ROUTES:return function(e,t){let n=!1;const r=t,{routesMap:o,inputRoutes:u}=ue(e.inputRoutes);if(r.forEach((({routeName:t,routeData:r})=>{const u=o[t];if(u){const t=u.parent,o=O({routes:[{...u,...r}],parent:t,_level:(t?._level||0)+1,basename:e.basename});t||(Object.assign(u,o[0]),n=!0),t&&t.items?(t.items.splice(t.items.indexOf(u),1,o[0]),n=!0):t&&t.children&&(t.children.splice(t.children.indexOf(u),1,o[0]),n=!0)}})),n){const t=e._getNewStateByNewInputRoutes(u);return{...e,...t,inputRoutes:[...u]}}return e}(e,r);case oe.UPDATE_INPUT_ROUTES:return{...e,inputRoutes:r};case oe.UPDATE_CURRENT_ROUTE:return{...e,currentRoute:r};case oe.UPDATE_STATE:return{...e,...r};default:return{...e}}}function ie(){return n.useContext(ae).methods.addRoutes}function ce(){return n.useContext(ae).methods.removeRoutes}function le(){return n.useContext(ae).methods.updateRoutes}ae.displayName="MRouterContext";const pe=[];function me(e){const t=window.location.pathname,n=ee();o((()=>{const r=n.current,o={name:"BeforeRouterLeave",pathname:t,fn:e};return r.push(o),()=>{const e=r.indexOf(o);r.splice(e,1)}}),[e,t,n])}function he(){const e=h(),t=a({}),{routesMap:r,inputRoutes:o,currentRoute:i,flattenRoutes:c,authInputRoutes:l,basename:p}=n.useContext(ae).state;t.current!==r&&(t.current=r);const m=u((()=>_(e.search)),[e.search]),E=f();return{navigate:(()=>{const e=R();return s(((t,n={})=>{if(n?.params&&"string"==typeof t&&(t=d(t,n.params)),n?.query&&"string"==typeof t){let e=t;const r=y(n.query);e=e.includes("?")?`${e}&${r}`:`${e}?${r}`,t=e}return e(t,n)}),[e])})(),routesMap:r,query:m,params:E,routes:o,authRoutes:l,currentRoute:i,flattenRoutes:c,location:e,basename:p}}const fe=({permissionList:e=pe,routerConfig:t,hasAuth:m,children:f},R)=>{const d=Z(),_=h(),y=a(_),A=n.useContext(Y).historyMethods,g=ee(),{routes:b=[],basename:v="/",beforeEachMount:T,autoDocumentTitle:C=!1}=t,M=u((()=>O({routes:b,basename:v})),[v,b]),P=a(M),[L]=r(function(e){const{inputRoutes:t,hasAuth:n,permissionList:r,beforeEachMount:o,basename:u,location:a,_defineId:s}=e,i=X.get(s);if(i){const t=function(e,t){return e.basename===t.basename&&e.hasAuth===t.hasAuth&&e.beforeEachMount===t.beforeEachMount&&e.inputRoutes===t.inputRoutes&&e.permissionList===t.permissionList}(i.queryData,e);if(t)return i.initialData}const c=x({inputRoutes:t,permissionList:r,hasAuth:n,beforeEachMount:o,basename:u,location:a});return X.set(s,{queryData:e,initialData:c}),c}({inputRoutes:M,permissionList:e,hasAuth:m,beforeEachMount:T,basename:v,location:y.current,_defineId:t._defineId})),N=a(null),D=s((t=>x({inputRoutes:t,permissionList:e,hasAuth:m,beforeEachMount:T,basename:v,location:_})),[v,T,m,_,e]);N.current=D;const[w,S]=i(se,{...L,inputRoutes:M,permissionList:e,hasAuth:m,basename:v,_getNewStateByNewInputRoutes:N.current});c(R,(()=>({updateCurrentRoute(e){const{pathname:t}=e,n=w.currentRoute,r=F(t,w.routesMap);let o=w.currentPathRoutes;r!==w.currentRoute&&(o=H(r)),S({type:oe.UPDATE_STATE,payload:{currentRoute:r,currentPathRoutes:o,prevRoute:n}})}}))),o((()=>{if(w.permissionList===e&&m===w.hasAuth&&w.inputRoutes===M&&w.beforeEachMount===T)return;let t=w.inputRoutes;if(P.current===M&&w.permissionList===e&&m===w.hasAuth&&w.beforeEachMount===T)return;P.current=M,t=M;const{authInputRoutes:n,flattenRoutes:r,routesMap:o,currentRoute:u,currentPathRoutes:a}=x({inputRoutes:t,permissionList:e,hasAuth:m,beforeEachMount:T,basename:v,location:_});S({type:oe.UPDATE_STATE,payload:{permissionList:e,authInputRoutes:n,routesMap:o,flattenRoutes:r,currentRoute:u,currentPathRoutes:a,basename:v,beforeEachMount:T}})}),[w.inputRoutes,M,e,w.permissionList,m,w.hasAuth,v,T,_]),l((()=>{if(!C)return;let e="";"boolean"==typeof C?e=w.currentPathRoutes.map((e=>e.title)).join("-"):"function"==typeof C&&(e=C(w.currentPathRoutes)),document.title=e}),[C,w.currentPathRoutes]);const $=s(((e,t)=>{"string"!=typeof t&&(t=t?.pathname);const n=window.location.pathname,r=function(e,t,n){return n.filter((n=>n.name===e&&n.pathname===t))}("BeforeRouterLeave",n,g.current);if(w.currentRoute?.beforeLeave&&r.unshift({name:"BeforeRouterLeave",pathname:w.currentRoute.path,fn:w.currentRoute.beforeLeave}),!r.length)return e();!function(e){const{to:t,from:n,callbacks:r,finish:o}=e;0===r.length?o():function e(u=0){const a=r[u];if(!a)return o();a.fn(t,n,(()=>{e(u+1)}))}(0)}({to:F(t,w.routesMap),from:F(n,w.routesMap),callbacks:r,finish:()=>e()})}),[g,w.currentRoute.beforeLeave,w.currentRoute.path,w.routesMap]);o((()=>{d.go=e=>{$((()=>A.go(e)))},d.push=(e,t)=>{e=V(e),$((()=>A.push(e,t)),e)},d.replace=(e,t)=>{e=V(e),$((()=>A.replace(e,t)),e)},d.back=()=>{$((()=>A.back()))},d.forward=()=>{$((()=>A.forward()))}}),[$,d,A]);const k=s((e=>{S({type:oe.ADD_ROUTES,payload:e})}),[]),I=s((e=>{S({type:oe.REMOVE_ROUTES,payload:e})}),[]),W=s((e=>{S({type:oe.UPDATE_ROUTES,payload:e})}),[]),j=s((e=>{e&&S({type:oe.UPDATE_CURRENT_ROUTE,payload:e})}),[]),q=u((()=>{const e=function e(t){const r=t.map((t=>{let r,o=[];const{_component:u,path:a,items:s,children:i,_isHasAuth:c,props:l}=t;if(u){const t=U.LoadingComponent;if(!c)return{path:a.endsWith("*")?a:`${a}/*`,element:n.createElement(p,{fallback:n.createElement(t,null)},n.createElement(u,l))};r={path:a,element:n.createElement(p,{fallback:t},n.createElement(u,l))},i&&(r.children=e(i)),s&&(o=e(s))}return[r,...o].filter((e=>void 0!==e))}));return Q(r)}(w.authInputRoutes);return e}),[w.authInputRoutes]),B=E(q),z=u((()=>f?f(B):B),[f,B]);return n.createElement(ae.Provider,{value:{state:w,methods:{addRoutes:k,updateCurrentRoute:j,removeRoutes:I,updateRoutes:W}}},z)},Re=n.forwardRef(fe);Re.displayName="MRouterContextProvider";const de=({permissionList:e,wrapComponent:t,hasAuth:r=!0,routerConfig:o,children:i,RouterComponent:c})=>{const l=a(null),p=s((e=>{l.current?.updateCurrentRoute?.(e)}),[]),m=u((()=>i&&"function"==typeof i?i:t?(t.displayName="WrapComponent",function(e){return n.createElement(t,null,e)}):void 0),[t,i]);return n.createElement(c,{syncUpdateCurrentRoute:p},n.createElement(Re,{routerConfig:o,permissionList:e,hasAuth:r,ref:l},m))},Ee=e=>n.createElement(de,Object.assign({},e,{RouterComponent:te})),_e=e=>n.createElement(de,Object.assign({},e,{RouterComponent:ne}));export{_e as MHRouter,Ee as MRouter,K as defineRouterConfig,ie as useAddRoutes,me as useBeforeLeave,Z as useHistory,ce as useRemoveRoutes,he as useRouter,le as useUpdateRoutes};
//# sourceMappingURL=react-router-manage.production.min.js.map
